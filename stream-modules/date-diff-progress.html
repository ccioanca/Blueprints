<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>Date Diff Progress</title>
  <meta name="description" content="Date Difference to Progress bar.">
  <meta name="author" content="Cristian">
  <style>
    html{
        margin: 0;
        padding: 0;
        background-color: black;
        height: 20px;
    }
    body{
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
    }
    #progress{
        width: 100%;
        height: 100%;
        background-color: black;
    }
  </style>
</head>
<body>
  <div id="progress"></div>

  <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
  <script src="../Scripts/stream-common.js"></script>
  <script>
    const startQP = "startDate";
    const endQP = "endDate";
    const intervalQP = "interval";

    var progress = $("#progress");
    var progress2 = $("#progress2");

    var green  = "#77D73C";
    var yellow = "#F1C31F";
    var red    = "#DF2F2F";

    $(document).ready(function(){
        // Get Query Params
        urlParams = new URLSearchParams(window.location.search);
        var startDate = new Date(urlParams.get(startQP)) || new Date(); //2022-07-13T14:00:00 (Jul 13 2PM)
        var endDate = new Date(urlParams.get(endQP)) || new Date();
        var interval = parseInt(urlParams.get(intervalQP)) || 1000;
        var intervalID;

        var countDown = function(){
            curDate = new Date();
            var perc = DateDiffToPercentage(startDate, endDate, curDate);
            console.log(perc);
            var progColor;

            var gRemap = createRemap(0.25,0.66, 0,1); 
            var rRemap = createRemap(0.66,1, 0,1); 

            if(perc < .25){
                progColor = hexToRGB(green);
            }
            else if(perc < .66)
            {
                // console.log(perc + " < .66");
                progColor = InterpolateHSL(hexToRGB(green), hexToRGB(yellow), gRemap(perc));
            }
            else{
                // console.log(perc + " > .66");
                progColor = InterpolateHSL(hexToRGB(yellow), hexToRGB(red), rRemap(perc));
            }

            progress.css("background-color", "rgb( "+progColor[0] +", "+progColor[1] +", "+progColor[2] +")");
            var width;
            if(perc < 0)
                width = 0;
            else if(perc > 1){
                width = 100;
                if(intervalID)
                    clearInterval(intervalID);
            }
            else 
                width = perc * 100;
            progress.css("width", width +"%");
        }

        countDown();
        intervalID = setInterval(countDown, interval);

    });

  </script>
</body>
</html>